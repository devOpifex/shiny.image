(()=>{"use strict";var e={n:n=>{var t=n&&n.__esModule?()=>n.default:()=>n;return e.d(t,{a:t}),t},d:(n,t)=>{for(var a in t)e.o(t,a)&&!e.o(n,a)&&Object.defineProperty(n,a,{enumerable:!0,get:t[a]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)};const n=jQuery;var t=e.n(n);function a(e){return e&&e.type.startsWith("image/")}function i(e){return new Promise((n,t)=>{const a=new FileReader;a.onload=e=>n(e.target.result),a.onerror=t,a.readAsDataURL(e)})}function o(e,n){e.find(".upload-area-error").remove();const a=t()(`<div class="upload-area-error">${n}</div>`);e.find(".image-upload-area").after(a),setTimeout(()=>a.fadeOut(()=>a.remove()),3e3)}async function r(e,n){const t=void 0!==e.find('input[type="file"]').attr("multiple");if(!t&&n.length>1)return void o(e,"Multiple files not allowed. Please select only one image.");const r=Array.from(n).filter(a);if(0!==r.length)if(!t&&r.length>1)o(e,"Please select only one image.");else try{const n=[];for(const e of r){const t=await i(e);n.push({name:e.name,size:e.size,type:e.type,dataURL:t})}s(e,n);const a=t?n:n[0];e.data("imageData",a),e.trigger("change")}catch(n){o(e,"Error processing image file(s)."),console.error("Image processing error:",n)}else o(e,"Please select valid image files.")}function s(e,n){const a=e.find(".image-thumbnail-container"),i=e.find(".image-upload-area");a.empty();const o=Array.isArray(n)?n:[n];o.forEach((n,i)=>{const o=(r=n.dataURL,l=n.name,t()(`\n    <div class="image-thumbnail">\n      <img src="${r}" alt="Thumbnail" />\n      <div class="thumbnail-info">\n        <span class="file-name">${l}</span>\n        <button class="remove-btn" type="button">&times;</button>\n      </div>\n    </div>\n  `));var r,l;o.find(".remove-btn").on("click",function(n){n.stopPropagation(),function(e,n){const t=e.data("imageData");Array.isArray(t)?(t.splice(n,1),0===t.length?(e.removeData("imageData"),s(e,[])):(e.data("imageData",t),s(e,t))):(e.removeData("imageData"),s(e,[])),e.trigger("change")}(e,i)}),a.append(o)}),o.length>0?(i.hide(),a.show()):(a.hide(),i.show())}Shiny;var l=new Shiny.InputBinding;t().extend(l,{find:function(e){return t()(e).find(".imageBinding")},initialize:function(e){var n;(n=t()(e)).find('input[type="file"]').on("change",function(){const e=this.files;e.length>0&&r(n,e)}),function(e){const n=e.find(".image-upload-area");let a=0;n.on("dragenter",function(e){e.preventDefault(),a++,t()(this).addClass("drag-over")}),n.on("dragover",function(e){e.preventDefault()}),n.on("dragleave",function(e){e.preventDefault(),a--,0===a&&t()(this).removeClass("drag-over")}),n.on("drop",function(n){n.preventDefault(),a=0,t()(this).removeClass("drag-over");const i=n.originalEvent.dataTransfer.files;i.length>0&&r(e,i)}),n.on("click",function(){e.find('input[type="file"]').click()}),n.on("keydown",function(n){"Enter"!==n.key&&" "!==n.key||(n.preventDefault(),e.find('input[type="file"]').click())})}(n),function(e){t()(document).on("paste",function(n){if(!e.is(":visible")||!e.find(".image-upload-area").is(":focus"))return;const t=n.originalEvent.clipboardData.items;for(let a=0;a<t.length;a++){const i=t[a];if("file"===i.kind&&i.type.startsWith("image/")){n.preventDefault();const t=i.getAsFile();r(e,[t]);break}}})}(n)},getValue:function(e){return t()(e).data("imageData")||null},setValue:function(e,n){const a=t()(e);null==n?(a.removeData("imageData"),s(a,[])):(a.data("imageData",n),s(a,n))},subscribe:function(e,n){t()(e).on("change.imageBinding",function(e){n()})},unsubscribe:function(e){t()(e).off(".imageBinding")},receiveMessage:function(e,n){n.hasOwnProperty("value")&&this.setValue(e,n.value)}}),Shiny.inputBindings.register(l,"shiny.image.imageBinding")})();